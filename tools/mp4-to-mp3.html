<!-- Add meta tag for the tool icon -->
<meta name="tool-icon" content="fas fa-file-audio">
<div class="tool-content" data-tool-icon="fas fa-file-audio">
    <style>
        /* MP4 to MP3 Converter Specific Styles */
        .converter-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--card-bg-color);
        }
        
        .file-upload-area:hover, .file-upload-area.active {
            border-color: var(--primary-color);
            background-color: var(--hover-bg-color);
        }
        
        .file-upload-area i {
            font-size: 2.5rem;
            color: var(--muted-text-color);
            margin-bottom: 1rem;
            display: block;
        }
        
        .file-upload-area p {
            margin-bottom: 1rem;
        }
        
        .hidden-input {
            display: none;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-top: 1rem;
            background-color: var(--card-bg-color);
        }
        
        .file-icon {
            font-size: 2rem;
            margin-right: 1rem;
            color: var(--primary-color);
        }
        
        .file-details {
            flex: 1;
        }
        
        .file-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
            word-break: break-all;
        }
        
        .file-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            color: var(--muted-text-color);
            font-size: 0.875rem;
        }
        
        .conversion-options {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .options-title {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .option-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .option-group {
            flex: 1;
            min-width: 200px;
        }
        
        .slider-group {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .slider-group label {
            width: 100px;
            margin-right: 1rem;
        }
        
        .slider-group input[type="range"] {
            flex: 1;
        }
        
        .slider-value {
            width: 50px;
            text-align: center;
            margin-left: 1rem;
        }
        
        .progress-container {
            margin-top: 1rem;
        }
        
        .progress-bar {
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            width: 0;
            transition: width 0.3s ease;
        }
        
        .progress-status {
            display: flex;
            justify-content: space-between;
            color: var(--muted-text-color);
            font-size: 0.875rem;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            padding: 0.75rem;
            border-radius: 4px;
            background-color: var(--card-bg-color);
            border-left: 4px solid var(--border-color);
        }
        
        .status-indicator i {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }
        
        .status-indicator.info {
            border-left-color: #3498db;
        }
        
        .status-indicator.success {
            border-left-color: #2ecc71;
        }
        
        .status-indicator.warning {
            border-left-color: #f39c12;
        }
        
        .status-indicator.error {
            border-left-color: #e74c3c;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .action-buttons button {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .action-buttons button i {
            font-size: 1.1rem;
        }
        
        .result-container {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            background-color: var(--card-bg-color);
        }
        
        .download-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            margin-top: 1rem;
        }
        
        .conversion-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .conversion-stat {
            flex: 1;
            min-width: 150px;
            padding: 0.75rem;
            background-color: var(--hover-bg-color);
            border-radius: 4px;
            text-align: center;
        }
        
        .stat-label {
            color: var(--muted-text-color);
            margin-bottom: 0.25rem;
        }
        
        .stat-value {
            font-weight: 500;
        }
        
        .audio-preview {
            width: 100%;
            margin-top: 1rem;
        }
        
        @keyframes processing {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .processing-icon {
            animation: processing 2s linear infinite;
            display: inline-block;
        }
    </style>

    <div class="tool-input">
        <h3>MP4 to MP3 Converter</h3>
        
        <div class="converter-container">
            <div class="status-indicator info" id="info-message">
                <i class="fas fa-info-circle"></i>
                <span>Upload an MP4 video file to extract its audio as MP3.</span>
            </div>
            
            <input type="file" id="video-input" accept="video/mp4" class="hidden-input">
            <div id="upload-area" class="file-upload-area">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & drop your MP4 file here</p>
                <p>or</p>
                <button id="browse-btn" class="secondary-btn">Browse Files</button>
                <p class="small">Maximum file size: 100MB</p>
            </div>
            
            <div id="file-info-container" style="display: none;">
                <div class="file-info">
                    <div class="file-icon">
                        <i class="fas fa-file-video"></i>
                    </div>
                    <div class="file-details">
                        <div class="file-name" id="file-name">filename.mp4</div>
                        <div class="file-meta">
                            <span id="file-size">0 MB</span>
                            <span id="file-duration">00:00</span>
                            <span id="file-type">video/mp4</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="conversion-options" class="conversion-options" style="display: none;">
                <h4 class="options-title">Conversion Options</h4>
                
                <div class="option-row">
                    <div class="option-group">
                        <div class="input-group">
                            <label for="bitrate-select">Audio Bitrate:</label>
                            <select id="bitrate-select" class="full-width">
                                <option value="128">128 kbps</option>
                                <option value="192" selected>192 kbps</option>
                                <option value="256">256 kbps</option>
                                <option value="320">320 kbps</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <div class="input-group">
                            <label for="channels-select">Audio Channels:</label>
                            <select id="channels-select" class="full-width">
                                <option value="1">Mono</option>
                                <option value="2" selected>Stereo</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="slider-group">
                    <label for="volume-slider">Volume:</label>
                    <input type="range" id="volume-slider" min="0" max="2" step="0.1" value="1">
                    <span class="slider-value" id="volume-value">1.0</span>
                </div>
                
                <div class="checkbox">
                    <input type="checkbox" id="trim-audio">
                    <label for="trim-audio">Trim Audio</label>
                </div>
                
                <div id="trim-options" style="display: none; margin-top: 1rem;">
                    <div class="option-row">
                        <div class="option-group">
                            <div class="input-group">
                                <label for="start-time">Start Time:</label>
                                <input type="text" id="start-time" placeholder="00:00" value="00:00">
                            </div>
                        </div>
                        <div class="option-group">
                            <div class="input-group">
                                <label for="end-time">End Time:</label>
                                <input type="text" id="end-time" placeholder="00:00" value="00:00">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="convert-btn" class="primary-btn">
                        <i class="fas fa-cog"></i> Convert to MP3
                    </button>
                    <button id="reset-btn" class="secondary-btn">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
                
                <div id="progress-container" class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <div class="progress-status">
                        <span id="progress-text">Processing...</span>
                        <span id="progress-percent">0%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tool-output" id="result-section" style="display: none;">
        <h3>Conversion Result</h3>
        
        <div class="result-container">
            <div id="success-message" class="status-indicator success">
                <i class="fas fa-check-circle"></i>
                <span>Your MP3 file is ready!</span>
            </div>
            
            <div class="conversion-stats">
                <div class="conversion-stat">
                    <div class="stat-label">Original Size</div>
                    <div class="stat-value" id="original-size">0 MB</div>
                </div>
                <div class="conversion-stat">
                    <div class="stat-label">MP3 Size</div>
                    <div class="stat-value" id="mp3-size">0 MB</div>
                </div>
                <div class="conversion-stat">
                    <div class="stat-label">Reduction</div>
                    <div class="stat-value" id="size-reduction">0%</div>
                </div>
                <div class="conversion-stat">
                    <div class="stat-label">Duration</div>
                    <div class="stat-value" id="mp3-duration">00:00</div>
                </div>
            </div>
            
            <audio id="audio-preview" class="audio-preview" controls></audio>
            
            <button id="download-btn" class="primary-btn download-btn">
                <i class="fas fa-download"></i> Download MP3 File
            </button>
        </div>
    </div>
</div>

<script>
function initmp4tomp3() {
    // Elements
    const videoInput = document.getElementById('video-input');
    const uploadArea = document.getElementById('upload-area');
    const browseBtn = document.getElementById('browse-btn');
    const fileInfoContainer = document.getElementById('file-info-container');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');
    const fileDuration = document.getElementById('file-duration');
    const fileType = document.getElementById('file-type');
    const conversionOptions = document.getElementById('conversion-options');
    const volumeSlider = document.getElementById('volume-slider');
    const volumeValue = document.getElementById('volume-value');
    const trimAudio = document.getElementById('trim-audio');
    const trimOptions = document.getElementById('trim-options');
    const startTime = document.getElementById('start-time');
    const endTime = document.getElementById('end-time');
    const convertBtn = document.getElementById('convert-btn');
    const resetBtn = document.getElementById('reset-btn');
    const progressContainer = document.getElementById('progress-container');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const progressPercent = document.getElementById('progress-percent');
    const resultSection = document.getElementById('result-section');
    const originalSize = document.getElementById('original-size');
    const mp3Size = document.getElementById('mp3-size');
    const sizeReduction = document.getElementById('size-reduction');
    const mp3Duration = document.getElementById('mp3-duration');
    const audioPreview = document.getElementById('audio-preview');
    const downloadBtn = document.getElementById('download-btn');
    const infoMessage = document.getElementById('info-message');
    
    // Variables
    let currentFile = null;
    let videoElement = null;
    let audioContext = null;
    let mediaSource = null;
    let analyzedDuration = '00:00';
    let convertedBlob = null;
    
    // File upload handlers
    browseBtn.addEventListener('click', () => {
        videoInput.click();
    });
    
    videoInput.addEventListener('change', handleFileSelect);
    
    // Drag and drop handlers
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('active');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('active');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('active');
        
        if (e.dataTransfer.files.length) {
            const file = e.dataTransfer.files[0];
            handleFile(file);
        }
    });
    
    // Volume slider
    volumeSlider.addEventListener('input', () => {
        volumeValue.textContent = parseFloat(volumeSlider.value).toFixed(1);
    });
    
    // Trim checkbox
    trimAudio.addEventListener('change', () => {
        trimOptions.style.display = trimAudio.checked ? 'block' : 'none';
    });
    
    // Convert button
    convertBtn.addEventListener('click', startConversion);
    
    // Reset button
    resetBtn.addEventListener('click', resetTool);
    
    // Download button
    downloadBtn.addEventListener('click', downloadMP3);
    
    // File selection handler
    function handleFileSelect() {
        if (videoInput.files.length) {
            const file = videoInput.files[0];
            handleFile(file);
        }
    }
    
    // File validation and processing
    function handleFile(file) {
        // Check if file is an MP4
        if (!file.type.includes('video/mp4')) {
            showError('Please select a valid MP4 file.');
            return;
        }
        
        // Check file size (max 100MB)
        if (file.size > 100 * 1024 * 1024) {
            showError('File is too large. Maximum size is 100MB.');
            return;
        }
        
        currentFile = file;
        
        // Update file info
        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
        fileType.textContent = file.type;
        
        // Create video element to get duration
        if (videoElement) {
            URL.revokeObjectURL(videoElement.src);
        }
        
        videoElement = document.createElement('video');
        videoElement.preload = 'metadata';
        videoElement.onloadedmetadata = () => {
            analyzedDuration = formatDuration(videoElement.duration);
            fileDuration.textContent = analyzedDuration;
            
            // Set default end time to video duration
            endTime.value = analyzedDuration;
            
            // Show options
            fileInfoContainer.style.display = 'block';
            conversionOptions.style.display = 'block';
            infoMessage.innerHTML = '<i class="fas fa-info-circle"></i><span>File loaded successfully. Configure your conversion options below.</span>';
        };
        videoElement.onerror = () => {
            showError('Unable to load video. The file might be corrupted.');
        };
        videoElement.src = URL.createObjectURL(file);
    }
    
    // Start conversion process
    function startConversion() {
        if (!currentFile) {
            showError('Please select a file first.');
            return;
        }
        
        // Show progress
        progressContainer.style.display = 'block';
        progressFill.style.width = '0%';
        progressText.textContent = 'Processing...';
        progressPercent.textContent = '0%';
        
        // Update message
        infoMessage.innerHTML = '<i class="fas fa-cog processing-icon"></i><span>Converting video to audio. This might take a moment...</span>';
        
        // Disable controls during conversion
        convertBtn.disabled = true;
        resetBtn.disabled = true;
        
        // Simulate processing (in a real app, this would be actual conversion)
        simulateConversion();
    }
    
    // Simulate the conversion process (for demo purposes)
    function simulateConversion() {
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 5;
            if (progress >= 100) {
                progress = 100;
                clearInterval(interval);
                conversionComplete();
            }
            
            updateProgress(progress);
        }, 200);
    }
    
    // Update progress display
    function updateProgress(progress) {
        const percentage = Math.min(Math.round(progress), 100);
        progressFill.style.width = `${percentage}%`;
        progressPercent.textContent = `${percentage}%`;
        
        if (percentage < 30) {
            progressText.textContent = 'Extracting audio...';
        } else if (percentage < 60) {
            progressText.textContent = 'Converting format...';
        } else if (percentage < 90) {
            progressText.textContent = 'Optimizing...';
        } else {
            progressText.textContent = 'Finalizing...';
        }
    }
    
    // Handle conversion completion
    function conversionComplete() {
        // In a real implementation, this would process the actual converted file
        // For demo, create a sample audio element with the original video
        
        // Enable controls
        convertBtn.disabled = false;
        resetBtn.disabled = false;
        
        // Update message
        infoMessage.innerHTML = '<i class="fas fa-check-circle"></i><span>Conversion completed successfully!</span>';
        infoMessage.className = 'status-indicator success';
        
        // Create a sample audio blob (in real implementation, this would be the converted audio)
        convertedBlob = currentFile; // This would normally be the actual MP3 blob
        
        // Calculate approximate MP3 size (for demo)
        const bitrate = parseInt(document.getElementById('bitrate-select').value);
        const originalSizeValue = currentFile.size;
        const estimatedMP3Size = Math.floor(originalSizeValue * (bitrate / 1000) / 8000);
        
        // Update stats
        originalSize.textContent = formatFileSize(originalSizeValue);
        mp3Size.textContent = formatFileSize(estimatedMP3Size);
        
        const reduction = Math.round((1 - estimatedMP3Size / originalSizeValue) * 100);
        sizeReduction.textContent = `${reduction}%`;
        mp3Duration.textContent = analyzedDuration;
        
        // Create audio preview from video (in a real app, this would be the MP3)
        audioPreview.src = URL.createObjectURL(currentFile);
        
        // Show result section
        resultSection.style.display = 'block';
    }
    
    // Download the converted MP3
    function downloadMP3() {
        if (!convertedBlob) return;
        
        // In a real implementation, this would be the actual MP3 file
        // For demo purposes, we're just downloading the original file with .mp3 extension
        const a = document.createElement('a');
        a.href = URL.createObjectURL(convertedBlob);
        
        // Get filename without extension
        const originalFilename = currentFile.name;
        const baseFilename = originalFilename.substring(0, originalFilename.lastIndexOf('.')) || originalFilename;
        
        a.download = `${baseFilename}.mp3`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
    
    // Reset the tool
    function resetTool() {
        // Clear file input
        videoInput.value = '';
        currentFile = null;
        
        // Hide elements
        fileInfoContainer.style.display = 'none';
        conversionOptions.style.display = 'none';
        progressContainer.style.display = 'none';
        resultSection.style.display = 'none';
        trimOptions.style.display = 'none';
        
        // Reset form elements
        volumeSlider.value = 1;
        volumeValue.textContent = '1.0';
        trimAudio.checked = false;
        startTime.value = '00:00';
        endTime.value = '00:00';
        document.getElementById('bitrate-select').value = '192';
        document.getElementById('channels-select').value = '2';
        
        // Reset audio preview
        audioPreview.src = '';
        
        // Reset message
        infoMessage.className = 'status-indicator info';
        infoMessage.innerHTML = '<i class="fas fa-info-circle"></i><span>Upload an MP4 video file to extract its audio as MP3.</span>';
        
        // Clear video element
        if (videoElement) {
            URL.revokeObjectURL(videoElement.src);
            videoElement = null;
        }
        
        // Clear blob
        convertedBlob = null;
    }
    
    // Show error message
    function showError(message) {
        infoMessage.className = 'status-indicator error';
        infoMessage.innerHTML = `<i class="fas fa-exclamation-circle"></i><span>${message}</span>`;
    }
    
    // Format file size
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Format duration
    function formatDuration(seconds) {
        seconds = Math.round(seconds);
        const minutes = Math.floor(seconds / 60);
        seconds = seconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    // Initialize
    // (Additional initialization code if needed)
}
</script> 