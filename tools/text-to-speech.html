<!-- Add meta tag for the tool icon -->
<meta name="tool-icon" content="fas fa-volume-up">
<div class="tool-content" data-tool-icon="fas fa-volume-up">
    <style>
        /* Text to Speech Converter Specific Styles */
        .tts-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .voice-options {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .voice-option {
            flex: 1;
            min-width: 200px;
        }
        
        .speech-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .speech-controls button {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .speech-controls button i {
            font-size: 1.1rem;
        }
        
        .speech-slider {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .speech-slider label {
            width: 120px;
            margin-right: 1rem;
        }
        
        .speech-slider input[type="range"] {
            flex: 1;
        }
        
        .speech-slider .value {
            width: 50px;
            text-align: center;
            margin-left: 1rem;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 0.5rem;
            background-color: var(--card-bg-color);
        }
        
        .history-item .text {
            flex: 1;
            margin-right: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-item .controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .history-item .controls button {
            padding: 0.25rem 0.5rem;
            font-size: 0.85rem;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 4px;
            color: var(--muted-text-color);
        }
        
        .status-indicator.speaking {
            background-color: rgba(var(--primary-color-rgb), 0.1);
            color: var(--primary-color);
            animation: pulse 1.5s infinite;
        }
        
        .status-indicator i {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }
        
        .download-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: none;
        }
        
        .format-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .format-options button {
            flex: 1;
            min-width: 100px;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
    </style>

    <div class="tool-input">
        <h3>Text to Speech Converter</h3>
        
        <div class="tts-container">
            <div class="input-group">
                <label for="text-input">Enter Text:</label>
                <textarea id="text-input" placeholder="Type or paste text here to convert to speech..." rows="6"></textarea>
            </div>
            
            <h4>Voice Options</h4>
            <div class="voice-options">
                <div class="voice-option">
                    <div class="input-group">
                        <label for="voice-select">Select Voice:</label>
                        <select id="voice-select">
                            <option value="">Loading voices...</option>
                        </select>
                    </div>
                </div>
                
                <div class="voice-option">
                    <div class="input-group">
                        <label for="language-select">Language:</label>
                        <select id="language-select">
                            <option value="all">All Languages</option>
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="ja">Japanese</option>
                            <option value="ko">Korean</option>
                            <option value="zh">Chinese</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <h4>Speech Settings</h4>
            <div class="speech-slider">
                <label for="rate-slider">Speed:</label>
                <input type="range" id="rate-slider" min="0.1" max="2" step="0.1" value="1">
                <span class="value" id="rate-value">1.0</span>
            </div>
            
            <div class="speech-slider">
                <label for="pitch-slider">Pitch:</label>
                <input type="range" id="pitch-slider" min="0.1" max="2" step="0.1" value="1">
                <span class="value" id="pitch-value">1.0</span>
            </div>
            
            <div class="speech-slider">
                <label for="volume-slider">Volume:</label>
                <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1">
                <span class="value" id="volume-value">1.0</span>
            </div>
            
            <div class="status-indicator" id="status-indicator">
                <i class="fas fa-info-circle"></i>
                <span>Ready to speak</span>
            </div>
            
            <div class="speech-controls">
                <button id="speak-btn" class="primary-btn">
                    <i class="fas fa-play"></i> Speak
                </button>
                <button id="pause-btn" class="secondary-btn" disabled>
                    <i class="fas fa-pause"></i> Pause
                </button>
                <button id="resume-btn" class="secondary-btn" disabled>
                    <i class="fas fa-play"></i> Resume
                </button>
                <button id="stop-btn" class="secondary-btn" disabled>
                    <i class="fas fa-stop"></i> Stop
                </button>
            </div>
            
            <div class="download-section" id="download-section">
                <h4>Download Audio</h4>
                <p>Note: Download functionality requires browser support and may not work in all browsers.</p>
                <div class="format-options">
                    <button id="download-btn" class="secondary-btn">
                        <i class="fas fa-download"></i> Download Audio
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tool-output">
        <h3>Speech History</h3>
        <div id="history-container">
            <p id="no-history-message">Your speech history will appear here.</p>
            <div id="history-list"></div>
        </div>
    </div>
</div>

<script>
function inittexttospeech() {
    // Elements
    const textInput = document.getElementById('text-input');
    const voiceSelect = document.getElementById('voice-select');
    const languageSelect = document.getElementById('language-select');
    const rateSlider = document.getElementById('rate-slider');
    const rateValue = document.getElementById('rate-value');
    const pitchSlider = document.getElementById('pitch-slider');
    const pitchValue = document.getElementById('pitch-value');
    const volumeSlider = document.getElementById('volume-slider');
    const volumeValue = document.getElementById('volume-value');
    const speakBtn = document.getElementById('speak-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const resumeBtn = document.getElementById('resume-btn');
    const stopBtn = document.getElementById('stop-btn');
    const downloadBtn = document.getElementById('download-btn');
    const downloadSection = document.getElementById('download-section');
    const statusIndicator = document.getElementById('status-indicator');
    const historyList = document.getElementById('history-list');
    const noHistoryMessage = document.getElementById('no-history-message');
    
    // Speech synthesis initialization
    const speech = window.speechSynthesis;
    let voices = [];
    let currentUtterance = null;
    let history = [];
    let isDownloadSupported = false;
    
    // Initialize voices
    function loadVoices() {
        voices = speech.getVoices();
        if (voices.length === 0) {
            // Some browsers need a small delay
            setTimeout(() => {
                voices = speech.getVoices();
                populateVoiceList();
            }, 200);
        } else {
            populateVoiceList();
        }
    }
    
    // Populate voice dropdown with available voices
    function populateVoiceList() {
        voiceSelect.innerHTML = '';
        
        const currentLanguage = languageSelect.value;
        let filteredVoices = voices;
        
        // Filter by language if selected
        if (currentLanguage !== 'all') {
            filteredVoices = voices.filter(voice => 
                voice.lang.startsWith(currentLanguage)
            );
        }
        
        if (filteredVoices.length === 0) {
            voiceSelect.innerHTML = '<option value="">No voices available for this language</option>';
            return;
        }
        
        filteredVoices.forEach(voice => {
            const option = document.createElement('option');
            option.value = voice.name;
            option.textContent = `${voice.name} (${voice.lang})`;
            if (voice.default) option.selected = true;
            voiceSelect.appendChild(option);
        });
    }
    
    // Load voices on page load
    if (speech.onvoiceschanged !== undefined) {
        speech.onvoiceschanged = loadVoices;
    }
    loadVoices();
    
    // Language filter change
    languageSelect.addEventListener('change', populateVoiceList);
    
    // Update value displays
    rateSlider.addEventListener('input', () => {
        rateValue.textContent = parseFloat(rateSlider.value).toFixed(1);
    });
    
    pitchSlider.addEventListener('input', () => {
        pitchValue.textContent = parseFloat(pitchSlider.value).toFixed(1);
    });
    
    volumeSlider.addEventListener('input', () => {
        volumeValue.textContent = parseFloat(volumeSlider.value).toFixed(1);
    });
    
    // Speech controls
    speakBtn.addEventListener('click', startSpeech);
    pauseBtn.addEventListener('click', pauseSpeech);
    resumeBtn.addEventListener('click', resumeSpeech);
    stopBtn.addEventListener('click', stopSpeech);
    downloadBtn.addEventListener('click', downloadSpeech);
    
    // Start speech
    function startSpeech() {
        const text = textInput.value.trim();
        if (!text) {
            alert('Please enter some text to convert to speech.');
            return;
        }
        
        // Stop any ongoing speech
        if (speech.speaking) {
            stopSpeech();
        }
        
        // Create a new utterance
        const utterance = new SpeechSynthesisUtterance(text);
        
        // Set selected voice
        const selectedVoice = voiceSelect.value;
        if (selectedVoice) {
            const voice = voices.find(v => v.name === selectedVoice);
            if (voice) utterance.voice = voice;
        }
        
        // Set speech parameters
        utterance.rate = parseFloat(rateSlider.value);
        utterance.pitch = parseFloat(pitchSlider.value);
        utterance.volume = parseFloat(volumeSlider.value);
        
        // Events
        utterance.onstart = () => {
            updateStatus('Speaking...', true);
            updateButtons(true, false);
        };
        
        utterance.onpause = () => {
            updateStatus('Paused', false);
            pauseBtn.disabled = true;
            resumeBtn.disabled = false;
        };
        
        utterance.onresume = () => {
            updateStatus('Speaking...', true);
            pauseBtn.disabled = false;
            resumeBtn.disabled = true;
        };
        
        utterance.onend = () => {
            updateStatus('Finished speaking', false);
            updateButtons(false, false);
            addToHistory(text, utterance);
        };
        
        utterance.onerror = (event) => {
            updateStatus(`Error: ${event.error}`, false);
            updateButtons(false, false);
        };
        
        // Start speaking
        currentUtterance = utterance;
        speech.speak(utterance);
    }
    
    // Pause speech
    function pauseSpeech() {
        if (speech.speaking) {
            speech.pause();
            updateStatus('Paused', false);
            pauseBtn.disabled = true;
            resumeBtn.disabled = false;
        }
    }
    
    // Resume speech
    function resumeSpeech() {
        if (speech.paused) {
            speech.resume();
            updateStatus('Speaking...', true);
            pauseBtn.disabled = false;
            resumeBtn.disabled = true;
        }
    }
    
    // Stop speech
    function stopSpeech() {
        if (speech.speaking) {
            speech.cancel();
            updateStatus('Stopped', false);
            updateButtons(false, false);
        }
    }
    
    // Update button states
    function updateButtons(isSpeaking, isPaused) {
        speakBtn.disabled = isSpeaking;
        pauseBtn.disabled = !isSpeaking || isPaused;
        resumeBtn.disabled = !isPaused;
        stopBtn.disabled = !isSpeaking;
    }
    
    // Update status indicator
    function updateStatus(message, isSpeaking) {
        statusIndicator.querySelector('span').textContent = message;
        
        if (isSpeaking) {
            statusIndicator.classList.add('speaking');
            statusIndicator.querySelector('i').className = 'fas fa-volume-up';
        } else {
            statusIndicator.classList.remove('speaking');
            statusIndicator.querySelector('i').className = 'fas fa-info-circle';
        }
    }
    
    // Add to history
    function addToHistory(text, utterance) {
        // Limit displayed history to last 10 items
        if (history.length >= 10) {
            history.shift();
        }
        
        // Add new item
        const historyItem = {
            id: Date.now(),
            text: text,
            voice: utterance.voice ? utterance.voice.name : 'Default',
            rate: utterance.rate,
            pitch: utterance.pitch,
            volume: utterance.volume
        };
        
        history.push(historyItem);
        updateHistoryDisplay();
    }
    
    // Update history display
    function updateHistoryDisplay() {
        if (history.length === 0) {
            noHistoryMessage.style.display = 'block';
            historyList.innerHTML = '';
            return;
        }
        
        noHistoryMessage.style.display = 'none';
        historyList.innerHTML = '';
        
        // Display most recent first
        history.slice().reverse().forEach(item => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            // Truncate long text for display
            let displayText = item.text;
            if (displayText.length > 60) {
                displayText = displayText.substring(0, 60) + '...';
            }
            
            historyItem.innerHTML = `
                <div class="text">${displayText}</div>
                <div class="controls">
                    <button class="secondary-btn replay-btn" data-id="${item.id}">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
            `;
            
            historyList.appendChild(historyItem);
        });
        
        // Add event listeners to replay buttons
        document.querySelectorAll('.replay-btn').forEach(button => {
            button.addEventListener('click', () => {
                const id = parseInt(button.getAttribute('data-id'));
                const item = history.find(h => h.id === id);
                
                if (item) {
                    textInput.value = item.text;
                    
                    // Find and select the voice
                    const voiceOption = Array.from(voiceSelect.options).find(
                        option => option.value === item.voice
                    );
                    
                    if (voiceOption) {
                        voiceSelect.value = item.voice;
                    }
                    
                    // Set other parameters
                    rateSlider.value = item.rate;
                    rateValue.textContent = item.rate.toFixed(1);
                    
                    pitchSlider.value = item.pitch;
                    pitchValue.textContent = item.pitch.toFixed(1);
                    
                    volumeSlider.value = item.volume;
                    volumeValue.textContent = item.volume.toFixed(1);
                    
                    // Start speaking
                    startSpeech();
                }
            });
        });
    }
    
    // Check if browser supports audio download (experimental)
    function checkDownloadSupport() {
        // This is a simplistic check - in reality, audio recording of speech synthesis
        // is complex and not universally supported across browsers
        if ('MediaRecorder' in window) {
            isDownloadSupported = true;
            downloadSection.style.display = 'block';
        }
    }
    
    // Download speech (experimental)
    function downloadSpeech() {
        // This is a placeholder for a more complex function
        // True audio recording/download would require additional libraries or backend support
        alert('This feature requires advanced browser support. As an alternative, many operating systems have built-in screen recording functionality that can capture audio output.');
    }
    
    // Initialize
    updateStatus('Ready to speak', false);
    updateButtons(false, false);
    checkDownloadSupport();
}
</script> 